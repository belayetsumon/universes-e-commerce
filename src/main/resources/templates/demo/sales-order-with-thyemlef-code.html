<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <style>
            @page {
                size: A4;
                margin: 20mm;
            }
            body {
                font-family: Arial, sans-serif;
                font-size: 12px;
                color: #222;
            }
            .header {
                display:flex;
                gap:12px;
                align-items:center;
            }
            .logo {
                max-height:70px;
                object-fit:contain;
            }
            .order-meta {
                margin-left:auto;
                text-align:right;
            }
            .merchant-stamp {
                width:180px;
                height:100px;
                border:1px dashed #bbb;
                display:flex;
                align-items:center;
                justify-content:center;
                font-size:11px;
                color:#444;
            }
            .items-grid {
                display:flex;
                flex-wrap:wrap;
                gap:8px;
                margin-top:8px;
            }
            .item-card {
                width:48%;
                box-sizing:border-box;
                border:1px solid #eee;
                padding:6px;
                font-size:12px;
            }
            .no-break {
                page-break-inside: avoid;
                -webkit-column-break-inside: avoid;
            }
            tbody tr {
                page-break-inside: avoid;
            }
            .page-break {
                display:block;
                page-break-before:always;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div>
                <img th:if="${companyLogoBase64}" th:src="${companyLogoBase64}" class="logo" alt="Logo" />
                <div th:text="${company.name}"></div>
                <div th:text="${company.address}"></div>
            </div>
            <div class="order-meta">
                <h1>SALES ORDER</h1>
                <div>Order #: <strong th:text="${order.orderNumber}"></strong></div>
                <div>Date: <span th:text="${order.date}"></span></div>
                <div>Status: <span th:text="${order.status}"></span></div>
                <img th:if="${barcodeBase64}" th:src="${barcodeBase64}" alt="barcode" style="margin-top:6px; max-width:240px;"/>
            </div>
        </div>


        <!-- Billing / Shipping -->
        <div style="display:flex; justify-content:space-between; margin-top:12px;">
            <div style="width:48%; border:1px solid #ddd; padding:8px;">
                <strong>BILL TO</strong>
                <div th:text="${order.billTo.name}"></div>
                <div th:text="${order.billTo.addressLine1}"></div>
                <div th:text="${order.billTo.city}"></div>
            </div>
            <div style="width:48%; border:1px solid #ddd; padding:8px;">
                <strong>SHIP TO</strong>
                <div th:text="${order.shipTo.name}"></div>
                <div th:text="${order.shipTo.addressLine1}"></div>
                <div th:text="${order.shipTo.city}"></div>
            </div>
        </div>


        <!-- Items -->
        <div th:if="${order.items.size() <= 20}">
            <table style="width:100%; border-collapse:collapse; margin-top:12px;">
                <thead>
                    <tr>
                        <th>#</th><th>SKU</th><th>Product</th><th>Qty</th><th>Unit Price</th><th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item,iter : ${order.items}" class="no-break">
                        <td th:text="${iter.index+1}"></td>
                        <td th:text="${item.sku}"></td>
                        <td th:text="${item.name}"></td>
                        <td th:text="${item.qty}"></td>
                        <td th:text="${item.unitPrice}"></td>
                        <td th:text="${item.totalPrice}"></td>
                    </tr>
                </tbody>
                </html>